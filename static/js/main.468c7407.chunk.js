(this["webpackJsonp@shipsgold/open-rpc-near-transport"]=this["webpackJsonp@shipsgold/open-rpc-near-transport"]||[]).push([[0],{105:function(e,t){},172:function(e,t,n){"use strict";n.r(t);var r,a,c,o,s=n(0),i=n(80),u=n.n(i),p=n(40),d=n(2),f=n(8),l=n(14),h=n(51),b=n(1),w=n.n(b),j=n(3),g=n(41),m=n.n(g),O=n(52),v=n(13),x=n.n(v),y=n(5),k=n(4),S={frontendURI:"http://localhost:3000"},I=function(){var e=Object(j.a)(w.a.mark((function e(t){var n,r,a,c;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=5,r=!1;case 2:if(!n--||r){e.next=10;break}return a=Object(y.a)(t),e.next=6,Object(y.b)(a,t);case 6:c=e.sent,r=c.isSignedIn(),e.next=2;break;case 10:return e.abrupt("return",r||n>0);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N={__walletAuth:{method:function(){var e=Object(j.a)(w.a.mark((function e(t){var n,r;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(y.a)(t),e.next=3,Object(y.b)(n,t);case 3:return r=e.sent,e.abrupt("return",Object(y.d)(r,t,t));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),desc:"Authorize contract"}},U=O.a.div(r||(r=Object(h.a)(["\n  text-align: center;\n  font-size: 1.95rem;\n  margin-left: 20px;\n  margin-right: 20px;\n  color: black;\n"]))),J=O.a.div(a||(a=Object(h.a)(["\n  display: flex;\n  flex-direction: column;\n  align-self: center;\n"]))),M=function(){var e=Object(j.a)(w.a.mark((function e(t,n,r){var a,c,o,s,i;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(y.a)(r),e.next=3,Object(y.b)(a);case 3:return c=e.sent,o=Object(l.a)({},n),delete n.attachedDeposit,delete n.gas,s=o.attachedDeposit||"0",i=o.gas||"3000000",e.next=11,c.account().functionCall({args:n,contractId:r,methodName:t,attachedDeposit:new x.a(s),gas:new x.a(i)});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),E=function(){var e=Object(d.e)(),t=Object(s.useState)(),n=Object(f.a)(t,2),r=n[0],a=n[1],c=Object(s.useState)(""),o=Object(f.a)(c,2),i=o[0],u=o[1],p=Object(s.useState)(""),l=Object(f.a)(p,2),h=l[0],b=l[1],g=Object(s.useState)(),O=Object(f.a)(g,2),v=O[0],x=O[1],y=Object(s.useState)(),E=Object(f.a)(y,2),R=E[0],_=E[1],L=Object(s.useState)(),q=Object(f.a)(L,2),C=q[0],D=q[1],T=Object(s.useState)(),A=Object(f.a)(T,2),H=A[0],P=A[1],B=Object(s.useState)(),W=Object(f.a)(B,2),z=W[0],K=W[1];return Object(s.useEffect)((function(){window.addEventListener("message",(function(e){if(e.origin===S.frontendURI)try{var t=JSON.parse(e.data);if(t.method){var n=N[t.method]?N[t.method]:{method:function(){return!0},desc:""};x(t.params),a(n),b(t.contractId),u(t.method),_(t.count),D(t.total)}}catch(r){}}),!1)}),[]),Object(s.useEffect)((function(){function e(){return(e=Object(j.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:R&&C&&r&&v&&setTimeout(Object(j.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v.attachedDeposit&&!v.gas){e.next=6;break}return e.next=3,M(i,v,h);case 3:t=e.sent,e.next=9;break;case 6:return e.next=8,r.method(h);case 8:t=e.sent;case 9:P(t);case 10:case"end":return e.stop()}}),e)}))),2500);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()})),Object(s.useEffect)((function(){function t(){return(t=Object(j.a)(w.a.mark((function t(){var n,r,a,c,o,s;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=function(){return m.a.parse(e.search,{ignoreQueryPrefix:!0})}(),window.opener===window||null===window.opener||!n.transactionHashes){t.next=9;break}if(!z){t.next=5;break}return t.abrupt("return");case 5:return K(n.transactionHashes),r=JSON.stringify({success:n.transactionHashes,value:H}),window.opener.postMessage(r,S.frontendURI),t.abrupt("return");case 9:if(window.opener===window||null===window.opener||!n.public_key){t.next=15;break}return t.next=12,I(h);case 12:return(a=t.sent)?(c=JSON.stringify({success:n.public_key,value:a}),window.opener.postMessage(c,S.frontendURI)):(o=JSON.stringify({failure:{errorCode:3272,errorMessage:"could not sign in"}}),window.opener.postMessage(o,S.frontendURI)),t.abrupt("return");case 15:window.opener!==window&&null!==window.opener&&n.errorCode&&(s=JSON.stringify({failure:{errorCode:n.errorCode,errorMessage:n.errorMessage}}),window.opener.postMessage(s,S.frontendURI));case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e.search,H,K,z,h]),Object(k.jsxs)(J,{children:[r&&Object(k.jsxs)(U,{children:["Loading wallet to sign transaction ",R," of ",C," for ",r&&r.desc]}),!r&&Object(k.jsx)(U,{children:"Loading wallet "})]})},R=n(89),_=n(84),L=n(85),q=0,C={connect:function(){var e=Object(j.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("transport"),c=new L.a(t),console.log("connecting ".concat(c.contractId)),e.next=5,c.connect();case 5:return o=e.sent,console.log("connected ".concat(c.contractId)),e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),sendData:function(e){if(!c)throw new Error("Not Connected");return c.sendData({internalID:q++,request:e})},sendResponse:function(){var e=Object(j.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("sendResponse"),o&&o.close(),e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};function D(e){return T.apply(this,arguments)}function T(){return(T=Object(j.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("origin",t.origin),console.log("data",t.data.error),"rpc.discover"!==t.data.method){e.next=5;break}return t.source.postMessage({jsonrpc:"2.0",result:_,id:t.data.id},t.origin),e.abrupt("return");case 5:if(C[t.data.method]){e.next=8;break}return window.parent.postMessage({jsonrpc:"2.0",error:{code:32009,message:"Method not found"},id:t.data.id},t.origin),e.abrupt("return");case 8:C[t.data.method].apply(C,Object(R.a)(t.data.params)).then((function(e){window.parent.postMessage({jsonrpc:"2.0",result:e,id:t.data.id},t.origin)})).catch((function(e){t.source.postMessage({jsonrpc:"2.0",error:{code:32329,message:e.message},id:t.data.id},t.origin)}));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=function(){return Object(s.useEffect)((function(){function e(){return(e=Object(j.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.addEventListener("message",D);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){e.apply(this,arguments)}(),function(){window.removeEventListener("message",D)}})),Object(k.jsx)("div",{children:" "})},H=function(){var e=Object(d.e)();return Object(s.useEffect)((function(){function e(){return(e=Object(j.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(y.b)("testnet");case 2:return t=e.sent,e.next=5,Object(y.d)(t,"mkt.landofswapps.testnet","mkt.landofswapps.testnet");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()})),Object(s.useEffect)((function(){var t=m.a.parse(e.search,{ignoreQueryPrefix:!0}),n=t.account_id,r=t.failure;if(r){var a=JSON.stringify({failure:r});console.error(a)}if(window.opener!==window&&null!==window.opener&&""!==n&&n){var c=JSON.stringify({account_id:n});console.info(c)}}),[e]),Object(k.jsx)("div",{children:" Yess "})},P=function(){return Object(k.jsx)(p.a,{children:Object(k.jsxs)(d.c,{children:[Object(k.jsx)(d.a,{path:"/open-rpc-near-transport/walletAuth",element:Object(k.jsx)(H,{})}),Object(k.jsx)(d.a,{path:"/open-rpc-near-transport/connect",element:Object(k.jsx)(H,{})}),Object(k.jsx)(d.a,{path:"/open-rpc-near-transport/walletSigning",element:Object(k.jsx)(E,{})}),Object(k.jsx)(d.a,{path:"/open-rpc-near-transport",element:Object(k.jsx)(A,{})}),Object(k.jsx)(d.a,{path:"/",element:Object(k.jsx)(A,{})})]})})};u.a.render(Object(k.jsx)(P,{}),document.getElementById("root"));t.default={}},26:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r={mainnet:{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",walletUrl:"https://wallet.mainnet.near.org",helperUrl:"https://helper.mainnet.near.org"},testnet:{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org"}},a=function(e){return r[e]}},5:function(e,t,n){"use strict";n.d(t,"c",(function(){return p})),n.d(t,"a",(function(){return d})),n.d(t,"d",(function(){return h})),n.d(t,"b",(function(){return b}));var r=n(1),a=n.n(r),c=n(14),o=n(3),s=n(17),i=n(26);var u=function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.connect)(Object(c.a)({deps:{keyStore:new s.keyStores.BrowserLocalStorageKeyStore},headers:{}},Object(i.a)(t)));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function p(e){return!(!e||e.length<3||!e.endsWith(".near")&&!e.endsWith(".testnet"))}function d(e){return e.split(".testnet").length>1?"testnet":"mainnet"}function f(e){return l.apply(this,arguments)}function l(){return(l=Object(o.a)(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,e.abrupt("return",new s.WalletConnection(t,n));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=function(){var e=Object(o.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==t.isSignedIn()){e.next=3;break}return e.next=3,t.requestSignIn(n,r,"".concat(window.location),"".concat(window.location,"?failure=true"));case 3:return e.abrupt("return",t.getAccountId());case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function b(e){return w.apply(this,arguments)}function w(){return(w=Object(o.a)(a.a.mark((function e(t){var n,r,c=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:null,e.next=3,u(t);case 3:return r=e.sent,e.abrupt("return",f(r,n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},55:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r,a=n(1),c=n.n(a),o=n(3),s=(n(5),function(){var e=Object(o.a)(c.a.mark((function e(t,n){var a,s,i,u,p=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=p.length>2&&void 0!==p[2]?p[2]:function(e){return""},s=p.length>3&&void 0!==p[3]?p[3]:Object(o.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)}))),u=new Promise((function(e,t){window.addEventListener("message",(function c(o){if(o.origin===n)try{var s,i,u=JSON.parse(o.data);if(a(u),void 0!==u.success)null===(s=r)||void 0===s||s.close(),r=null,window.removeEventListener("message",c),e(u);if(void 0!==u.failure)null===(i=r)||void 0===i||i.close(),r=null,window.removeEventListener("message",c),t(u)}catch(p){console.warn(o.data),console.warn(p)}}),!1)})),e.next=5,s();case 5:return!0===e.sent&&1===t.count&&(i=window.open("".concat(n,"/open-rpc-near-transport/walletSigning"),void 0,"popup=yes,left=0,top=0,width=400px,height=800px"),r=i),setTimeout((function(){var e;null===(e=r)||void 0===e||e.postMessage(JSON.stringify(t),"".concat(n))}),3e3),e.abrupt("return",u);case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},84:function(e){e.exports=JSON.parse('{"openrpc":"1.0.0","info":{"title":"foo","version":"1.0.0"},"methods":[{"name":"connect","description":"connect to transport","summary":"connect transport","params":[{"name":"uri","description":"the uri to connect to","required":true,"schema":{"type":"string"}}],"result":{"name":"connected","description":"connected or not","schema":{"type":"boolean"}}},{"name":"sendData","description":"send data across the transport","params":[{"name":"data","description":"data to send","schema":true}],"result":{"name":"result","schema":true}},{"name":"sendResponse","description":"send response from callback","params":[{"name":"response","description":"response data","schema":true}],"result":{"name":"sentResponse","schema":true}}]}')},85:function(e,t,n){"use strict";(function(e){var r=n(1),a=n.n(r),c=n(3),o=n(14),s=n(86),i=n(87),u=n(90),p=n(88),d=n(18),f=n(19),l=n(17),h=n(26),b=n(55),w=n(5),j=function(t){Object(u.a)(r,t);var n=Object(p.a)(r);function r(e){var t;Object(s.a)(this,r),(t=n.call(this)).uri=void 0,t.near=void 0,t.contractId=void 0,t.uri=e,t.contractId=t.getContractId(e);var a=Object(w.a)(e),c=Object(h.a)(a),i=new l.keyStores.BrowserLocalStorageKeyStore;return t.near=new l.Near(Object(o.a)(Object(o.a)({},c),{},{headers:{},deps:{keyStore:i}})),t}return Object(i.a)(r,[{key:"getContractId",value:function(e){return e}},{key:"connect",value:function(){var e=Object(c.a)(a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(w.c)(this.contractId)){e.next=2;break}return e.abrupt("return");case 2:return(t=new URL(window.location.origin)).origin||alert("No origin host"),console.log("creating window with this path ".concat(t.origin)),n=Object(w.a)(this.contractId),e.next=8,Object(w.b)(n,this.contractId);case 8:return r=e.sent,e.next=11,r.isSignedIn();case 11:if(e.sent){e.next=15;break}return e.next=15,Object(b.a)({count:1,total:1,method:"__walletAuth",params:[],contractId:this.contractId},t.origin,(function(){return!0}),Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!r.isSignedIn());case 1:case"end":return e.stop()}}),e)}))));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendData",value:function(){var t=Object(c.a)(a.a.mark((function t(n){var r,c,s,i,u,p,d,l,j,g,m,O,v,x,y,k,S,I,N,U,J=arguments;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=J.length>1&&void 0!==J[1]?J[1]:5e3,Object(w.c)(this.contractId)){t.next=3;break}return t.abrupt("return",void 0);case 3:if(c=n.request,console.log(n,r),s=Object(w.a)(this.contractId),i=Object(h.a)(s),u=function(t){return e.from(JSON.stringify(t)).toString("base64")},p={finality:"optimistic"},d=Object(o.a)(Object(o.a)({request_type:"call_function"},p),{},{account_id:this.contractId,method_name:c.method,args_base64:u(c.params)}),(l=new URL(window.location.origin)).origin||alert("No origin host"),"rpc.discover"!==c.method){t.next=22;break}return j=new f.HTTPTransport(i.nodeUrl),g=new f.RequestManager([j]),m=new f.Client(g),t.next=18,m.request({method:"query",params:d});case 18:if((O=t.sent).result){t.next=21;break}return t.abrupt("return",O);case 21:return t.abrupt("return",Object.assign(O,{result:JSON.parse(e.from(O.result).toString())}));case 22:if(v=c.params,x=v.gas,y=v.attachedDeposit,!x&&!y){t.next=29;break}return console.log(c.params),t.next=27,Object(b.a)({count:1,method:c.method,params:c.params,total:1,contractId:this.contractId},l.origin);case 27:return k=t.sent,t.abrupt("return",k);case 29:return S=new f.HTTPTransport(i.nodeUrl),I=new f.RequestManager([S]),N=new f.Client(I),t.next=34,N.request({method:"query",params:d});case 34:if((U=t.sent).result){t.next=37;break}return t.abrupt("return",U);case 37:return t.abrupt("return",Object.assign(U,{result:JSON.parse(e.from(U.result).toString())}));case 38:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"close",value:function(){}}]),r}(d.Transport);t.a=j}).call(this,n(16).Buffer)},99:function(e,t){}},[[172,1,2]]]);
//# sourceMappingURL=main.468c7407.chunk.js.map